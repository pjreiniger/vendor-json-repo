name: 'Add Vendordep'
description: 'Adds a vendordep to the repository and creates a pull request the upstream repo'

inputs:
  token:
    description: 'Build Buddy API token'
    required: true
  vendordep_file:
    description: 'Path to the vendordep file to upload'
    required: true
  pr_title:
    description: 'The contents used as the PR title when opening the pull request'
  is_beta:
    description: "If true, this will be added to the years beta files"
    default: false
    

runs:
  using: "composite"
  steps:
    - uses: actions/checkout@v4
      with:
        repository: 'pjreiniger/vendor-json-repo'
        fetch-depth: 0  # Fetch all history so we can use git diff
        path: "vendor-json-repo"
        ref: "main"

    - uses: actions/setup-python@v5
      with:
        python-version: '3.12'
    
    - name: Add vendordep
      run: python add_vendordep.py --vendordep_file=$VENDORDEP_FILE --is_beta=$IS_BETA
      env:
        VENDORDEP_FILE: ${{ inputs.vendordep_file }}
        IS_BETA: ${{ inputs.is_beta }}
    - name: Create Gentool Pull Request
      uses: peter-evans/create-pull-request@v6
      with:
        path: vendor-json-repo
        base: main
        token: ${{ inputs.token }}
        branch_suffix: timestamp
        title:  ${{ inputs.pr_title }}